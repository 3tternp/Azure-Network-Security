{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
	"parameters": {
		"resourceName": {
			"type": "string",
			"defaultValue": "embargosanctionappgwwafpolicy",
			"metadata": {
				"description": "The name of embargo and sanction App Gw WAF Policy."
			}
		},
		"embargoSanctionList": {
			"type": "array",
			"defaultValue": ["BY","BA","CF","CN","CU","CD","ET","IR","IQ","LB","LY","ML","MM","NI","KP","RU","SO","SS","SD","SY","VE","YE","ZW"],
			"metadata": {
				"description": "The Country Codes in array list to be blocked due to emabro or sanctions as an example."
			}
		}
	},
    "resources": [
        {
            "apiVersion": "2019-09-01",
            "type": "Microsoft.Network/applicationGatewayWebApplicationFirewallPolicies",
            "name": "[parameters('resourceName')]",
            "location": "[resourceGroup().location]",
            "tags": {},
            "properties": {
                "customRules": [
                    {
                        "name": "SanctionedandEmbargoedDeny",
                        "priority": 10,
                        "ruleType": "MatchRule",
                        "matchConditions": [
                            {
                                "matchVariables": [
                                    {
                                        "variableName": "RemoteAddr",
                                        "selector": null
                                    }
                                ],
                                "operator": "GeoMatch",
                                "negationConditon": false,
                                "matchValues": "[parameters('EmbargoSanctionList')]",
                                "transforms": []
                            }
                        ],
                        "action": "Block"
                    },
                    {
                        "name": "CountriesLogged",
                        "priority": 20,
                        "ruleType": "MatchRule",
                        "action": "Log",
                        "matchConditions": [
                          {
                            "matchVariables": [
                              {
                                "variableName": "RemoteAddr"
                              }
                            ],
                            "operator": "GeoMatch",
                            "negationConditon": false,
                            "matchValues": [
                              "AD",
                              "AE",
                              "AF",
                              "AG",
                              "AI",
                              "AL",
                              "AM",
                              "AO",
                              "AQ",
                              "AR",
                              "AS",
                              "AT",
                              "AU",
                              "AW",
                              "AZ",
                              "BA",
                              "BB",
                              "BD",
                              "BE",
                              "BF",
                              "BG",
                              "BH",
                              "BI",
                              "BJ",
                              "BL",
                              "BM",
                              "BN",
                              "BO",
                              "BR",
                              "BS",
                              "BT",
                              "BW",
                              "BY",
                              "BZ",
                              "CA",
                              "CC",
                              "CD",
                              "CG",
                              "CF",
                              "CH",
                              "CI",
                              "CK",
                              "CL",
                              "CM",
                              "CN",
                              "CO",
                              "CR",
                              "CU",
                              "CV",
                              "CW",
                              "CX",
                              "CY",
                              "CZ",
                              "DE",
                              "DJ",
                              "DK",
                              "DM",
                              "DO",
                              "DZ",
                              "EC",
                              "EE",
                              "EG",
                              "ER",
                              "ES",
                              "ET",
                              "FI",
                              "FJ",
                              "FK",
                              "FM",
                              "FO",
                              "FR",
                              "GA",
                              "GB",
                              "GD",
                              "GE",
                              "GF",
                              "GG",
                              "GH",
                              "GI",
                              "GL",
                              "GM",
                              "GN",
                              "GP",
                              "GQ",
                              "GR",
                              "GT",
                              "GU",
                              "GW",
                              "GY",
                              "HK",
                              "HN",
                              "HR",
                              "HT",
                              "HU",
                              "ID",
                              "IE",
                              "IL",
                              "IO",
                              "IM",
                              "IN",
                              "IQ",
                              "IR",
                              "IS",
                              "IT",
                              "JE",
                              "JM",
                              "JO",
                              "JP",
                              "KE",
                              "KG",
                              "KH",
                              "KI",
                              "KM",
                              "KN",
                              "KP",
                              "KR",
                              "KW",
                              "KY",
                              "KZ",
                              "LA",
                              "LB",
                              "LC",
                              "LI",
                              "LK",
                              "LR",
                              "LS",
                              "LT",
                              "LU",
                              "LV",
                              "LY",
                              "MA",
                              "MC",
                              "MD",
                              "ME",
                              "MF",
                              "MG",
                              "MH",
                              "MK",
                              "ML",
                              "MM",
                              "MN",
                              "MO",
                              "MP",
                              "MQ",
                              "MR",
                              "MS",
                              "MT",
                              "MU",
                              "MV",
                              "MW",
                              "MX",
                              "MY",
                              "MZ",
                              "NA",
                              "NC",
                              "NE",
                              "NG",
                              "NI",
                              "NL",
                              "NO",
                              "NP",
                              "NR",
                              "NU",
                              "NZ",
                              "OM",
                              "PA",
                              "PE",
                              "PF",
                              "PG",
                              "PH",
                              "PK",
                              "PL",
                              "PM",
                              "PN",
                              "PR",
                              "PS",
                              "PT",
                              "PW",
                              "PY",
                              "QA",
                              "RE",
                              "RO",
                              "RS",
                              "RU",
                              "RW",
                              "SA",
                              "SB",
                              "SC",
                              "SD",
                              "SE",
                              "SG",
                              "SI",
                              "SJ",
                              "SK",
                              "SL",
                              "SM",
                              "SN",
                              "SO",
                              "SR",
                              "SS",
                              "ST",
                              "SV",
                              "SX",
                              "SY",
                              "SZ",
                              "TC",
                              "TD",
                              "TK",
                              "TG",
                              "TH",
                              "TJ",
                              "TM",
                              "TN",
                              "TO",
                              "TR",
                              "TT",
                              "TV",
                              "TW",
                              "TZ",
                              "UA",
                              "UG",
                              "US",
                              "UY",
                              "UZ",
                              "VA",
                              "VC",
                              "VE",
                              "VG",
                              "VI",
                              "VN",
                              "VU",
                              "WF",
                              "WS",
                              "YE",
                              "YT",
                              "ZA",
                              "ZM",
                              "ZW"
                            ],
                            "transforms": []
                          }
                        ],
                        "skippedManagedRuleSets": []
                      }
                ],
                "policySettings": {
                    "fileUploadLimitInMb": 100,
                    "maxRequestBodySizeInKb": 128,
                    "mode": "Prevention",
                    "requestBodyCheck": true,
                    "state": "Enabled"
                },
                "managedRules": {
                    "exclusions": [],
                    "managedRuleSets": [
                        {
                            "ruleSetType": "OWASP",
                            "ruleSetVersion": "3.2",
                            "ruleGroupOverrides": []
                        },
                        {
                            "ruleSetType": "Microsoft_BotManagerRuleSet",
                            "ruleSetVersion": "0.1",
                            "ruleGroupOverrides": []
                        }
                    ]
                }
            }
        }
    ]
}